<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Timesheet{% endblock %}</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- Tryb ciemny -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!--Font Roboto, bo najpiękniejszy-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="{{ url_for('index') }}">Twój Timesheet</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ml-auto">
      {% if current_user.is_authenticated %}
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('logout') }}">Wyloguj</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('report') }}">Raport</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('add_user_page') }}">Dodaj Użytkownika</a>
        </li>
        <li class="nav-item">
            {% if current_user.is_authenticated %}
                <a class="nav-link" href="{{ url_for('add_campaign_page', user_id=current_user.id) }}">Dodaj Kampanię</a>
            {% endif %}
        </li>
      {% else %}
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('login') }}">Zaloguj</a>
        </li>
      {% endif %}
    </ul>
  </div>
  <!-- Toggle do trybu ciemnego -->
  <div class="form-check form-switch">
    <input class="form-check-input dark-mode-toggle" type="checkbox" id="darkModeToggle">
    <label class="form-check-label" for="darkModeToggle">Tryb ciemny</label>
  </div>
</nav>

<div class="container {% if is_dark_mode %}dark-mode{% endif %}">
    {% block content %}{% endblock %}
</div>

<!-- JS do trybu ciemnego-->
<script>
// Funkcja do ustawiania trybu ciemnego
function setDarkMode(isDarkMode) {
    document.body.classList.toggle('dark-mode', isDarkMode);
    const navbar = document.querySelector('.navbar');
    navbar.classList.toggle('navbar-dark', isDarkMode);
    navbar.classList.toggle('bg-dark', isDarkMode);

    // Bezpośrednie manipulowanie klasą tabeli, bo coś nie działa
    const tables = document.querySelectorAll('.table-dark-mode');
    tables.forEach(table => {
        if (isDarkMode) {
            table.classList.add('table-dark');
        } else {
            table.classList.remove('table-dark');
        }
    });
}

// Funkcja do ustawiania trybu ciemnego na podstawie danych z localStorage
function initializeDarkMode() {
    // Domyślnie ustaw tryb ciemny jako włączony, I believe in dark mode supremacy
    const isDarkMode = localStorage.getItem('darkMode') !== 'false';
    setDarkMode(isDarkMode);
    document.getElementById('darkModeToggle').checked = isDarkMode;
}

// Obsługa zmiany stanu przełącznika
document.getElementById('darkModeToggle').addEventListener('change', function () {
    const isDarkMode = this.checked;
    setDarkMode(isDarkMode);
    // Zapisz preferencję trybu w localStorage
    localStorage.setItem('darkMode', isDarkMode.toString());
});

// Inicjuje przy załadowaniu strony
document.addEventListener('DOMContentLoaded', initializeDarkMode);
</script>
</body>
</html>
